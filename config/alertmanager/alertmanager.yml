# Alertmanager é…ç½®æ–‡ä»¶
# å‘Šè­¦é€šçŸ¥è·¯ç”±å’Œæ¥æ”¶å™¨é…ç½®

global:
  # SMTP æœåŠ¡å™¨é…ç½®ï¼ˆé‚®ä»¶é€šçŸ¥ï¼‰
  smtp_smarthost: 'localhost:587'
  smtp_from: 'alertmanager@your-domain.com'
  smtp_auth_username: 'alertmanager@your-domain.com'
  smtp_auth_password: 'your-email-password'
  smtp_require_tls: true
  
  # å…¨å±€æ ‡ç­¾
  smtp_hello: 'alertmanager'
  
  # è§£æè¶…æ—¶
  resolve_timeout: 5m

# æ¨¡æ¿æ–‡ä»¶è·¯å¾„
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# å‘Šè­¦è·¯ç”±é…ç½®
route:
  # é»˜è®¤æ¥æ”¶å™¨
  receiver: 'default-receiver'
  
  # åˆ†ç»„é…ç½®
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  
  # å­è·¯ç”±é…ç½®
  routes:
    # ä¸¥é‡å‘Šè­¦ç«‹å³é€šçŸ¥
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 5m
      continue: true
    
    # ç³»ç»Ÿç›¸å…³å‘Šè­¦
    - match:
        category: system
      receiver: 'system-alerts'
      group_interval: 5m
      repeat_interval: 30m
    
    # ç½‘ç»œè®¾å¤‡å‘Šè­¦
    - match:
        category: network
      receiver: 'network-alerts'
      group_interval: 2m
      repeat_interval: 15m
    
    # æ€§èƒ½ç›¸å…³å‘Šè­¦
    - match:
        category: performance
      receiver: 'performance-alerts'
      group_interval: 5m
      repeat_interval: 1h
    
    # ç›‘æ§ç³»ç»Ÿè‡ªèº«å‘Šè­¦
    - match:
        category: monitoring
      receiver: 'monitoring-alerts'
      group_interval: 1m
      repeat_interval: 10m

# æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
  # å¦‚æœæœ‰ä¸¥é‡å‘Šè­¦ï¼ŒæŠ‘åˆ¶ç›¸åŒå®ä¾‹çš„è­¦å‘Šå‘Šè­¦
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['instance']
  
  # å¦‚æœæœåŠ¡ä¸å¯ç”¨ï¼ŒæŠ‘åˆ¶è¯¥æœåŠ¡çš„å…¶ä»–å‘Šè­¦
  - source_match:
      alertname: 'ServiceDown'
    target_match_re:
      alertname: '.*'
    equal: ['instance', 'job']

# æ¥æ”¶å™¨é…ç½®
receivers:
  # é»˜è®¤æ¥æ”¶å™¨
  - name: 'default-receiver'
    email_configs:
      - to: 'admin@your-domain.com'
        subject: '[ç›‘æ§å‘Šè­¦] {{ .GroupLabels.alertname }}'
        body: |
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          å®ä¾‹: {{ .Labels.instance }}
          {{ end }}
    
    # Webhook é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
    webhook_configs:
      - url: 'http://your-webhook-url/alerts'
        send_resolved: true
        http_config:
          basic_auth:
            username: 'webhook-user'
            password: 'webhook-password'
  
  # ä¸¥é‡å‘Šè­¦æ¥æ”¶å™¨
  - name: 'critical-alerts'
    email_configs:
      - to: 'critical-alerts@your-domain.com'
        subject: '[ğŸš¨ä¸¥é‡å‘Šè­¦] {{ .GroupLabels.alertname }}'
        body: |
          ğŸš¨ ä¸¥é‡å‘Šè­¦é€šçŸ¥ ğŸš¨
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          å®ä¾‹: {{ .Labels.instance }}
          æœåŠ¡: {{ .Labels.job }}
          {{ end }}
          
          è¯·ç«‹å³å¤„ç†ï¼
    
    # çŸ­ä¿¡é€šçŸ¥ï¼ˆéœ€è¦é…ç½®çŸ­ä¿¡ç½‘å…³ï¼‰
    webhook_configs:
      - url: 'http://sms-gateway/send'
        send_resolved: true
  
  # ç³»ç»Ÿå‘Šè­¦æ¥æ”¶å™¨
  - name: 'system-alerts'
    email_configs:
      - to: 'system-admin@your-domain.com'
        subject: '[ç³»ç»Ÿå‘Šè­¦] {{ .GroupLabels.alertname }}'
        body: |
          ç³»ç»Ÿå‘Šè­¦é€šçŸ¥
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          å®ä¾‹: {{ .Labels.instance }}
          {{ end }}
  
  # ç½‘ç»œå‘Šè­¦æ¥æ”¶å™¨
  - name: 'network-alerts'
    email_configs:
      - to: 'network-admin@your-domain.com'
        subject: '[ç½‘ç»œå‘Šè­¦] {{ .GroupLabels.alertname }}'
        body: |
          ç½‘ç»œè®¾å¤‡å‘Šè­¦é€šçŸ¥
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          è®¾å¤‡: {{ .Labels.instance }}
          {{ end }}
  
  # æ€§èƒ½å‘Šè­¦æ¥æ”¶å™¨
  - name: 'performance-alerts'
    email_configs:
      - to: 'performance-team@your-domain.com'
        subject: '[æ€§èƒ½å‘Šè­¦] {{ .GroupLabels.alertname }}'
        body: |
          æ€§èƒ½å‘Šè­¦é€šçŸ¥
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          å®ä¾‹: {{ .Labels.instance }}
          å½“å‰å€¼: {{ .Annotations.value }}
          {{ end }}
  
  # ç›‘æ§ç³»ç»Ÿå‘Šè­¦æ¥æ”¶å™¨
  - name: 'monitoring-alerts'
    email_configs:
      - to: 'monitoring-team@your-domain.com'
        subject: '[ç›‘æ§ç³»ç»Ÿå‘Šè­¦] {{ .GroupLabels.alertname }}'
        body: |
          ç›‘æ§ç³»ç»Ÿå‘Šè­¦é€šçŸ¥
          
          {{ range .Alerts }}
          å‘Šè­¦åç§°: {{ .Annotations.summary }}
          å‘Šè­¦æè¿°: {{ .Annotations.description }}
          å‘Šè­¦çº§åˆ«: {{ .Labels.severity }}
          å‘Šè­¦æ—¶é—´: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          ç»„ä»¶: {{ .Labels.job }}
          å®ä¾‹: {{ .Labels.instance }}
          {{ end }}